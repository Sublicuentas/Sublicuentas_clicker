<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>Sublicuentas Clicker ‚Äì FIX</title>
<style>
  :root{ --bg:#061a35; --primary:#2dd4bf; --accent:#60a5fa; --text:#e5e7eb; }
  html,body{margin:0;height:100%;background:radial-gradient(1200px 800px at 20% 0%, #0b2b5c, var(--bg));font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",sans-serif;color:var(--text);}
  #ui{position:fixed;inset:0;display:grid;place-items:center;pointer-events:none}
  .card{pointer-events:auto;background:rgb(255 255 255 / 6%);backdrop-filter: blur(10px);border:1px solid rgb(255 255 255 / 14%);padding:24px;border-radius:20px;box-shadow:0 10px 30px rgb(0 0 0 / 35%);max-width:680px}
  h1{margin:0 0 10px;font-size:28px;letter-spacing:.5px}
  .btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;border:1px solid transparent;padding:12px 18px;border-radius:14px;cursor:pointer;font-weight:800}
  .btn.primary{background:linear-gradient(135deg,var(--primary),var(--accent));color:#031633}
  .btn.ghost{background:transparent;border-color:rgb(255 255 255 / 24%);color:var(--text)}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  #hud{position:fixed;top:10px;left:10px;right:10px;display:flex;justify-content:space-between;align-items:center;font-weight:800;text-shadow:0 2px 6px rgba(0,0,0,.6)}
  #hud .pill{background:rgb(255 255 255 / 12%);padding:8px 12px;border-radius:999px;border:1px solid rgb(255 255 255 / 18%)}
  canvas{display:block;width:100vw;height:100vh;touch-action:none}
  .hint{font-size:14px;opacity:.9;line-height:1.5}
</style>
</head>
<body>
<canvas id="game"></canvas>

<div id="hud" style="display:none">
  <div class="pill">‚è±Ô∏è <span id="time">30.0</span>s</div>
  <div class="pill">‚≠ê Puntos: <span id="score">0</span></div>
  <div class="pill">üí• Combo: <span id="combo">x1</span></div>
  <div class="pill">‚ù§Ô∏è <span id="lives">3</span></div>
  <div class="pill">üéØ <span id="levelname">-</span></div>
</div>

<div id="ui">
  <div id="start" class="card">
    <h1>üéÆ Sublicuentas Clicker</h1>
    <ul class="hint">
      <li><b>Toque solo los c√≠rculos</b> con nombres de plataformas para sumar puntos.</li>
      <li><b>Evite tocar otra figura</b> (cuadrado, rect√°ngulo, tri√°ngulo): ‚àí10 pts y ‚àí1 vida.</li>
      <li>Duraci√≥n: 30 segundos.</li>
    </ul>
    <p style="margin-top:6px"><b>Elija un nivel:</b></p>
    <div class="row levels">
      <button class="btn primary" data-level="beginner">Principiante (+5 pts)</button>
      <button class="btn ghost" data-level="intermediate">Intermedio (+10 pts)</button>
      <button class="btn ghost" data-level="advanced">Avanzado (+15 pts)</button>
    </div>
    <div class="row" style="margin-top:10px">
      <button class="btn ghost" id="how">¬øC√≥mo reclamo premio?</button>
    </div>
  </div>
  <div id="howcard" class="card" style="display:none">
    <h1>üéÅ ¬øC√≥mo ganar/regalar?</h1>
    <ol style="padding-left:18px;line-height:1.5">
      <li>Juegue y obtenga su <b>puntaje</b>.</li>
      <li>Al final toque <b>Reclamar por WhatsApp</b>.</li>
      <li>Env√≠e su puntaje y captura.</li>
    </ol>
    <div class="row"><button class="btn primary" id="backToStart">Volver</button></div>
  </div>
  <div id="gameover" class="card" style="display:none"></div>
</div>

<script>
// ===== Utilidades
const lerp=(a,b,t)=>a+(b-a)*t;
const rand=(min,max)=>Math.random()*(max-min)+min;

// ===== Canvas
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
function resize(){ canvas.width=innerWidth*2; canvas.height=innerHeight*2; }
addEventListener('resize',resize); resize();

// ===== Dificultad
const DIFFICULTY = {
  beginner:   { name:'Principiante', points:5, time:30 },
  intermediate:{ name:'Intermedio',  points:10, time:30 },
  advanced:   { name:'Avanzado',     points:15, time:30 }
};
let currentDiff = DIFFICULTY.beginner;

// ===== Estado
let running=false, timeLeft=30, score=0, combo=1, lives=3;
let lastTime=0, spawnTimer=0, targets=[]; 
let shake=0, maxCombo=1;
const PENALTY = 10; 
const COLORS = ['#22c55e','#3b82f6','#a855f7','#ef4444','#f59e0b','#e11d48','#06b6d4','#10b981','#f97316','#84cc16','#38bdf8','#f43f5e'];

const hud=({show})=>{
  document.getElementById('hud').style.display=show?'flex':'none';
  document.getElementById('score').textContent=score;
  document.getElementById('time').textContent=timeLeft.toFixed(1);
  document.getElementById('combo').textContent='x'+(Math.round(combo*10)/10);
  document.getElementById('lives').textContent=lives;
  document.getElementById('levelname').textContent=currentDiff.name;
};

// ===== Contenido
const PLATFORM_NAMES = ['NETFLIX','DEEZER','DISNEY+','CRUNCHYROLL','PRIME VIDEO','HBO MAX','VIX','PARAMOUNT+','FREE FIRE','CANVA','MAGIS','UMBRA'];
const DECOY_NAMES = ['CUADRADO','RECT√ÅNGULO','TRI√ÅNGULO'];

// ===== Target
class Target{
  constructor(){
    const pad=100;
    this.r = rand(65,110);
    this.x = rand(pad, canvas.width-pad);
    this.y = rand(pad, canvas.height-pad);
    this.life = 0.9;
    this.hit=false;

    if(Math.random()<0.5){ this.kind='circle'; }
    else { this.kind = ['square','rect','triangle'][Math.floor(Math.random()*3)]; }
    this.label = this.kind==='circle' ? PLATFORM_NAMES[Math.floor(Math.random()*PLATFORM_NAMES.length)] : DECOY_NAMES[['square','rect','triangle'].indexOf(this.kind)];
    this.color = COLORS[Math.floor(Math.random()*COLORS.length)];
    this.vx = rand(-80,80); this.vy = rand(-80,80); this.spin = rand(-3,3);
    this.rotation = rand(0,Math.PI*2);
  }
  update(dt){
    this.life -= dt;
    this.x += this.vx*dt; this.y += this.vy*dt; this.rotation += this.spin*dt*0.45;
    if(this.x < 100 || this.x > canvas.width-100) this.vx *= -1;
    if(this.y < 100 || this.y > canvas.height-100) this.vy *= -1;
  }
  draw(){
    const {x,y,r,kind} = this;
    ctx.save();
    ctx.translate(x,y); ctx.rotate(this.rotation);

    const g=ctx.createRadialGradient(0,0,0,0,0,r*1.4);
    g.addColorStop(0, this.color + 'aa');
    g.addColorStop(1, 'transparent');
    ctx.globalAlpha=0.35; ctx.fillStyle=g; ctx.beginPath(); ctx.arc(0,0,r*1.4,0,Math.PI*2); ctx.fill();
    ctx.globalAlpha=1;

    ctx.fillStyle = this.color;
    ctx.strokeStyle='rgba(255,255,255,.95)';
    ctx.lineWidth=8;

    let maxTextW;
    if(kind==='circle'){
      ctx.beginPath(); ctx.arc(0,0,r,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(0,0,r-8,0,Math.PI*2); ctx.stroke();
      maxTextW = r*1.55; // padded
    } else if(kind==='square'){
      const s=r*1.5;
      ctx.beginPath(); ctx.rect(-s/2,-s/2,s,s); ctx.fill();
      ctx.strokeRect(-s/2+8,-s/2+8,s-16,s-16);
      maxTextW = s*0.82;
    } else if(kind==='rect'){
      const w=r*2.2, h=r*1.2;
      ctx.beginPath(); ctx.rect(-w/2,-h/2,w,h); ctx.fill();
      ctx.strokeRect(-w/2+8,-h/2+8,w-16,h-16);
      maxTextW = w*0.82;
    } else if(kind==='triangle'){
      const s=r*2.0;
      ctx.beginPath();
      ctx.moveTo(0,-s/2);
      ctx.lineTo(s/2,s/2);
      ctx.lineTo(-s/2,s/2);
      ctx.closePath(); ctx.fill();
      ctx.beginPath();
      ctx.moveTo(0,-s/2+8);
      ctx.lineTo(s/2-8,s/2-8);
      ctx.lineTo(-s/2+8,s/2-8);
      ctx.closePath(); ctx.stroke();
      maxTextW = s*0.82;
    }

    // Texto grande horizontal
    ctx.save();
    ctx.rotate(-this.rotation);
    ctx.textAlign='center'; ctx.textBaseline='middle';
    let fontSize = (kind==='circle') ? r*0.95 : r*0.85;
    if(kind==='rect' || kind==='triangle') fontSize = r*0.78;
    ctx.font = `900 ${fontSize}px system-ui,Segoe UI,Roboto`;
    const label = this.label;
    let w = ctx.measureText(label).width; let guard=0;
    while(w > maxTextW && guard < 20){
      fontSize *= 0.9;
      ctx.font = `900 ${fontSize}px system-ui,Segoe UI,Roboto`;
      w = ctx.measureText(label).width; guard++;
    }
    ctx.lineWidth = Math.max(8, fontSize*0.14);
    ctx.strokeStyle = 'rgba(0,0,0,.85)';
    ctx.fillStyle = '#ffffff';
    ctx.strokeText(label, 0, 4);
    ctx.fillText(label, 0, 4);
    ctx.restore();

    ctx.restore();
  }
  contains(px,py){
    const dx = px - this.x; const dy = py - this.y;
    if(this.kind==='circle'){
      return (dx*dx+dy*dy) <= (this.r*this.r);
    } else if(this.kind==='square'){
      const s=this.r*1.5;
      return (dx >= -s/2 && dx <= s/2 && dy >= -s/2 && dy <= s/2);
    } else if(this.kind==='rect'){
      const w=this.r*2.2, h=this.r*1.2;
      return (dx >= -w/2 && dx <= w/2 && dy >= -h/2 && dy <= h/2);
    } else if(this.kind==='triangle'){
      const s=this.r*2.0;
      return (dx >= -s/2 && dx <= s/2 && dy >= -s/2 && dy <= s/2);
    }
  }
}

// ===== UI wiring
document.getElementById('how').onclick=()=>{document.getElementById('start').style.display='none'; document.getElementById('howcard').style.display='block'};
document.getElementById('backToStart').onclick=()=>{document.getElementById('howcard').style.display='none'; document.getElementById('start').style.display='block'};

document.querySelectorAll('[data-level]').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const lv = btn.getAttribute('data-level');
    currentDiff = DIFFICULTY[lv];
    startGame();
  });
});

function startGame(){
  running=true; timeLeft=currentDiff.time; score=0; combo=1; lives=3; targets=[]; spawnTimer=0; lastTime=performance.now(); maxCombo=1;
  document.getElementById('start').style.display='none'; document.getElementById('howcard').style.display='none'; document.getElementById('gameover').style.display='none';
  hud({show:true});
  requestAnimationFrame(loop);
}

function endGame(){
  running=false; hud({show:false});
  // Emoji segun puntaje
  let badge='üê£'; if(score>=21 && score<=50) badge='‚ö°'; else if(score>=51 && score<=100) badge='üî•'; else if(score>=101) badge='üëë';
  const body = `${badge} Sublicuentas Clicker\nPuntaje: ${score}\nQuiero reclamar mi premio`;
  const encoded = encodeURIComponent(body);
  const claimNumber = '50422554675';
  const shareUrl = `https://wa.me/${claimNumber}?text=${encoded}`;
  const genericShare = `https://wa.me/?text=${encoded}&type=custom_url`;

  const over = document.getElementById('gameover');
  over.innerHTML = `
    <h1>üèÅ ¬°Fin de la partida!</h1>
    <p style="margin:.2rem 0 .6rem"><b>Nivel:</b> ${currentDiff.name}</p>
    <p style="margin:.2rem 0 1rem">Puntaje total: <b>${score}</b></p>
    <div class="row" style="margin-bottom:10px">
      <button class="btn primary" id="again">Elegir nivel</button>
      <button class="btn ghost" id="claim">Reclamar por WhatsApp</button>
    </div>
    <div class="row">
      <button class="btn ghost" id="share">Compartir puntaje</button>
    </div>
  `;
  document.getElementById('again').onclick=()=>{document.getElementById('start').style.display='block'; over.style.display='none';};
  document.getElementById('claim').onclick=()=>{window.open(shareUrl,'_blank')};
  document.getElementById('share').onclick=()=>{
    if(navigator.share){
      navigator.share({title:'Sublicuentas Clicker', text: body, url: location.href}).catch(()=>window.open(genericShare,'_blank'))
    } else {
      window.open(genericShare,'_blank');
    }
  };
  over.style.display='block';
}

// ===== Entrada
canvas.addEventListener('pointerdown', e=>{
  if(!running) return;
  const rect = canvas.getBoundingClientRect();
  const x = (e.clientX - rect.left) * (canvas.width / rect.width);
  const y = (e.clientY - rect.top) * (canvas.height / rect.height);
  let hitIndex=-1, best=Infinity;
  for(let i=0;i<targets.length;i++){
    if(targets[i].contains(x,y)){
      const dx=x-targets[i].x, dy=y-targets[i].y, d=dx*dx+dy*dy;
      if(d<best){ best=d; hitIndex=i; }
    }
  }
  if(hitIndex>-1){
    const t=targets[hitIndex];
    if(!t.hit){
      t.hit=true; targets.splice(hitIndex,1);
      if(t.kind==='circle'){ score += Math.floor(currentDiff.points*combo); combo=Math.min(10,combo+0.25); }
      else { score=Math.max(0,score-10); lives-=1; combo=1; shake=12; }
    }
  } else { combo=1; }
});

// ===== Loop
function loop(now){
  if(!running) return;
  const dt = Math.min(0.033,(now-lastTime)/1000); lastTime=now;
  timeLeft -= dt; if(timeLeft<=0 || lives<=0){ endGame(); return; }

  spawnTimer -= dt; if(spawnTimer<=0){
    targets.push(new Target());
    if(Math.random()<0.35) targets.push(new Target());
    const rate = lerp(0.55, 0.16, 1 - (timeLeft/30));
    spawnTimer = rate;
  }

  for(let i=targets.length-1;i>=0;i--){
    const t=targets[i]; t.update(dt);
    if(t.life<=0){ if(t.kind==='circle'){ lives-=1; combo=1; shake=8; } targets.splice(i,1); }
  }

  ctx.save();
  const s=shake; shake=Math.max(0,shake-60*dt);
  ctx.translate((Math.random()*2-1)*s, (Math.random()*2-1)*s);
  ctx.clearRect(-10,-10,canvas.width+20,canvas.height+20);
  const grd=ctx.createLinearGradient(0,0,canvas.width,canvas.height);
  grd.addColorStop(0,'#0b2b5c'); grd.addColorStop(1,'#061a35'); ctx.fillStyle=grd; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.globalAlpha=0.08; for(let i=0;i<40;i++){ ctx.fillStyle=i%2?'#60a5fa':'#2dd4bf'; ctx.beginPath(); ctx.arc((i*97)%canvas.width,(i*173)%canvas.height,(i%7+2)*8,0,Math.PI*2); ctx.fill(); }
  ctx.globalAlpha=1;
  targets.forEach(t=>t.draw());
  ctx.restore();

  hud({show:true});
  requestAnimationFrame(loop);
}
</script>
</body>
</html>
