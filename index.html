<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Sublicuentas Clicker ‚Äì Demo</title>
  <style>
    :root{
      --bg:#061a35; --primary:#2dd4bf; --accent:#60a5fa; --warn:#f59e0b; --danger:#ef4444; --text:#e5e7eb;
    }
    html,body{margin:0;height:100%;background:radial-gradient(1200px 800px at 20% 0%, #0b2b5c, var(--bg));font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",sans-serif;color:var(--text);}
    #ui{position:fixed;inset:0;display:grid;place-items:center;pointer-events:none}
    .card{pointer-events:auto;background:rgb(255 255 255 / 5%);backdrop-filter: blur(8px);border:1px solid rgb(255 255 255 / 12%);padding:24px;border-radius:20px;box-shadow:0 10px 30px rgb(0 0 0 / 30%);max-width:520px}
    h1{margin:0 0 10px;font-size:28px;letter-spacing:.5px}
    p{margin:.4rem 0 1rem;opacity:.9}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;border:1px solid transparent;padding:12px 18px;border-radius:14px;cursor:pointer;font-weight:700}
    .btn.primary{background:linear-gradient(135deg,var(--primary),var(--accent));color:#031633}
    .btn.ghost{background:transparent;border-color:rgb(255 255 255 / 20%);color:var(--text)}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    #hud{position:fixed;top:10px;left:10px;right:10px;display:flex;justify-content:space-between;align-items:center;font-weight:800;text-shadow:0 2px 6px rgba(0,0,0,.6)}
    #hud .pill{background:rgb(255 255 255 / 10%);padding:8px 12px;border-radius:999px;border:1px solid rgb(255 255 255 / 18%)}
    canvas{display:block;width:100vw;height:100vh;touch-action:none}
    a{color:inherit}
  </style>
</head>
<body>
  <canvas id="game"></canvas>
  <div id="hud" style="display:none">
    <div class="pill">‚è±Ô∏è <span id="time">30.0</span>s</div>
    <div class="pill">‚≠ê Puntos: <span id="score">0</span></div>
    <div class="pill">üí• Combo: <span id="combo">x1</span></div>
    <div class="pill">‚ù§Ô∏è <span id="lives">3</span></div>
  </div>
  
  <div id="ui">
    <div id="start" class="card">
      <h1>üéÆ Sublicuentas Clicker</h1>
      <p>Toque los √≠conos que aparezcan antes de que desaparezcan. Acierte para sumar <b>puntos</b> y aumente el <b>combo</b>. Evite fallar: solo tiene <b>3 vidas</b>. La partida dura <b>30 segundos</b>.</p>
      <div class="row">
        <button class="btn primary" id="play">Jugar ahora</button>
        <button class="btn ghost" id="how">¬øC√≥mo reclamo premio?</button>
      </div>
    </div>
    <div id="howcard" class="card" style="display:none">
      <h1>üéÅ ¬øC√≥mo ganar/regalar?</h1>
      <ol style="padding-left:18px;line-height:1.5">
        <li>Juegue y obtenga su <b>puntaje</b>.</li>
        <li>En la pantalla final toque <b>Reclamar por WhatsApp</b>.</li>
        <li>Env√≠e su puntaje y comprobante del reto (captura de pantalla).</li>
      </ol>
      <div class="row"><button class="btn primary" id="backToStart">Volver</button></div>
    </div>
    <div id="gameover" class="card" style="display:none"></div>
  </div>

  <script>
  // --- Utilidades ---
  const lerp=(a,b,t)=>a+(b-a)*t;
  const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
  const rand=(min,max)=>Math.random()*(max-min)+min;

  // --- Canvas y tama√±o ---
  const canvas=document.getElementById('game');
  const ctx=canvas.getContext('2d');
  function resize(){
    canvas.width=window.innerWidth*2; // HiDPI
    canvas.height=window.innerHeight*2;
  }
  window.addEventListener('resize',resize);
  resize();

  // --- Estado del juego ---
  let running=false, timeLeft=30, score=0, combo=1, lives=3;
  let lastTime=0, spawnTimer=0, targets=[]; // objetivos en pantalla
  let clickCooldown=0;

  const hud=({show})=>{
    document.getElementById('hud').style.display=show?'flex':'none';
    document.getElementById('score').textContent=score;
    document.getElementById('time').textContent=timeLeft.toFixed(1);
    document.getElementById('combo').textContent='x'+combo;
    document.getElementById('lives').textContent=lives;
  };

  // --- Objetivo ---
  const PLATFORMS = [
    { key:'NF', color:'#e50914'}, { key:'DZ', color:'#6c2bd9'},
    { key:'DS', color:'#1dcaff'}, { key:'CR', color:'#f97316'},
    { key:'AM', color:'#00a8e1'}, { key:'HB', color:'#6b21a8'},
    { key:'PR', color:'#f59e0b'}, { key:'PM', color:'#1f2937'},
    { key:'FF', color:'#22c55e'}, { key:'CN', color:'#10b981'},
    { key:'MG', color:'#3b82f6'}, { key:'UM', color:'#111827'}
  ];

  class Target{
    constructor(){
      const pad=80; // margen
      this.r = rand(55,85);
      this.x = rand(pad, canvas.width-pad);
      this.y = rand(pad, canvas.height-pad);
      this.life = 1.2; // segundos
      this.hit=false;
      this.platform = PLATFORMS[Math.floor(Math.random()*PLATFORMS.length)];
      this.vx = rand(-40,40);
      this.vy = rand(-40,40);
      this.spin = rand(-2,2);
      this.a = 0; // anim
      this.rotation = rand(0,Math.PI*2);
    }
    update(dt){
      this.life -= dt;
      this.a = clamp(1 - (1.2-this.life)/1.2, 0, 1); // entrada suave
      this.x += this.vx*dt; this.y += this.vy*dt; this.rotation += this.spin*dt*0.4;
    }
    draw(){
      const {x,y,r,platform,rotation} = this;
      ctx.save();
      ctx.translate(x,y); ctx.rotate(rotation);
      // glow
      const g=ctx.createRadialGradient(0,0,0,0,0,r*1.2);
      g.addColorStop(0, platform.color+"aa");
      g.addColorStop(1, "transparent");
      ctx.globalAlpha=0.35; ctx.fillStyle=g; ctx.beginPath(); ctx.arc(0,0,r*1.2,0,Math.PI*2); ctx.fill();
      ctx.globalAlpha=1;
      // base
      ctx.fillStyle=platform.color;
      ctx.beginPath(); ctx.arc(0,0,r,0,Math.PI*2); ctx.fill();
      // anillo
      ctx.lineWidth=8; ctx.strokeStyle='rgba(255,255,255,.85)'; ctx.beginPath(); ctx.arc(0,0,r-6,0,Math.PI*2); ctx.stroke();
      // letras
      ctx.fillStyle='#031633'; ctx.font=(r*0.8)+'px 700 system-ui'; ctx.textAlign='center'; ctx.textBaseline='middle';
      ctx.fillText(platform.key,0,4);
      ctx.restore();
    }
    contains(px,py){
      const dx = px - this.x; const dy = py - this.y; return (dx*dx+dy*dy) <= (this.r*this.r);
    }
  }

  // --- UI ---
  const uiStart = document.getElementById('start');
  const uiHow = document.getElementById('howcard');
  const uiOver = document.getElementById('gameover');
  document.getElementById('how').onclick=()=>{uiStart.style.display='none'; uiHow.style.display='block'};
  document.getElementById('backToStart').onclick=()=>{uiHow.style.display='none'; uiStart.style.display='block'};
  document.getElementById('play').onclick=()=>startGame();

  function startGame(){
    running=true; timeLeft=30; score=0; combo=1; lives=3; targets=[]; spawnTimer=0; lastTime=performance.now();
    uiStart.style.display='none'; uiHow.style.display='none'; uiOver.style.display='none';
    hud({show:true});
    requestAnimationFrame(loop);
  }

  function endGame(){
    running=false; hud({show:false});
    const text = `üéÆ Sublicuentas Clicker\n\nPuntaje: ${score}\nCombo m√°ximo: x${maxCombo}\n`;
    const encoded = encodeURIComponent(text + `Quiero reclamar mi premio.`);
    const claimNumber = '50422554675'; // N√∫mero configurado
    const shareUrl = `https://wa.me/${claimNumber}?text=${encoded}`;
    const genericShare = `https://wa.me/?text=${encodeURIComponent(`Hice ${score} puntos en Sublicuentas Clicker. ¬øPuedes superarme?`)}&type=custom_url`;

    uiOver.innerHTML = `
      <h1>üèÅ ¬°Fin de la partida!</h1>
      <p style="margin:.2rem 0 1rem">Puntaje total: <b>${score}</b></p>
      <div class="row" style="margin-bottom:10px">
        <button class="btn primary" id="again">Jugar de nuevo</button>
        <button class="btn ghost" id="claim">Reclamar por WhatsApp</button>
      </div>
      <div class="row">
        <button class="btn ghost" id="share">Compartir puntaje</button>
      </div>
    `;
    document.getElementById('again').onclick=()=>{startGame()};
    document.getElementById('claim').onclick=()=>{window.open(shareUrl,'_blank')};
    document.getElementById('share').onclick=()=>{
      if(navigator.share){
        navigator.share({title:'Sublicuentas Clicker', text:`Hice ${score} puntos en Sublicuentas Clicker.`, url:location.href}).catch(()=>window.open(genericShare,'_blank'))
      } else {
        window.open(genericShare,'_blank');
      }
    };
    document.getElementById('ui').querySelector('#gameover').style.display='block';
  }

  // --- Entrada (toque / click) ---
  function handlePoint(clientX, clientY){
    if(!running) return;
    const rect = canvas.getBoundingClientRect();
    const x = (clientX - rect.left) * (canvas.width / rect.width);
    const y = (clientY - rect.top) * (canvas.height / rect.height);

    // detectar objetivo m√°s cercano
    let hitIndex = -1; let bestDist = Infinity;
    for(let i=0;i<targets.length;i++){
      const t=targets[i];
      const dx=x - t.x, dy=y - t.y; const d2=dx*dx+dy*dy;
      if(d2 < t.r*t.r && d2 < bestDist){bestDist=d2; hitIndex=i;}
    }
    if(hitIndex>-1){
      const t = targets[hitIndex];
      if(!t.hit){ // evitar doble click
        t.hit=true; targets.splice(hitIndex,1);
        score += Math.floor(10 * combo);
        combo = Math.min(10, combo + 0.2);
        pulseHUD();
      }
    } else {
      combo = 1; lives -= 1; shake = 8; if(lives<=0) timeLeft = 0; // forzar fin
    }
  }
  canvas.addEventListener('pointerdown', e=>{ e.preventDefault(); handlePoint(e.clientX,e.clientY); });

  // --- Efectos HUD ---
  let shake=0, maxCombo=1;
  function pulseHUD(){
    maxCombo=Math.max(maxCombo, combo);
    document.getElementById('score').animate([{transform:'scale(1)'},{transform:'scale(1.12)'},{transform:'scale(1)'}],{duration:160});
    document.getElementById('combo').animate([{transform:'scale(1)'},{transform:'scale(1.1)'},{transform:'scale(1)'}],{duration:160});
  }

  // --- Bucle principal ---
  function loop(now){
    if(!running) return;
    const dt = Math.min(0.033, (now - lastTime)/1000); lastTime = now;

    // Tiempo
    timeLeft -= dt; if(timeLeft<=0){ endGame(); return; }

    // Spawning (acelera con el tiempo)
    spawnTimer -= dt; if(spawnTimer<=0){
      targets.push(new Target());
      const rate = lerp(0.9, 0.35, 1 - (timeLeft/30)); // m√°s r√°pido al final
      spawnTimer = rate;
    }

    // Actualizar
    for(let i=targets.length-1;i>=0;i--){
      const t=targets[i]; t.update(dt); if(t.life<=0){ targets.splice(i,1); combo=1; lives-=1; shake=8; }
    }

    // Dibujo
    ctx.save();
    const s = shake; shake = Math.max(0, shake - 60*dt);
    ctx.translate((Math.random()*2-1)*s, (Math.random()*2-1)*s);
    ctx.clearRect(-10,-10,canvas.width+20,canvas.height+20);

    // Fondo din√°mico
    const grd = ctx.createLinearGradient(0,0,canvas.width,canvas.height);
    grd.addColorStop(0,'#0b2b5c'); grd.addColorStop(1,'#061a35'); ctx.fillStyle=grd; ctx.fillRect(0,0,canvas.width,canvas.height);
    
    // Part√≠culas suaves
    ctx.globalAlpha=0.08; for(let i=0;i<40;i++){ ctx.fillStyle = i%2? '#60a5fa' : '#2dd4bf'; ctx.beginPath(); ctx.arc((i*97)%canvas.width, (i*173)%canvas.height, (i%7+2)*8, 0, Math.PI*2); ctx.fill(); }
    ctx.globalAlpha=1;

    // Dibujar objetivos
    targets.forEach(t=>t.draw());

    ctx.restore();

    // HUD
    hud({show:true});

    requestAnimationFrame(loop);
  }
  </script>
</body>
</html>